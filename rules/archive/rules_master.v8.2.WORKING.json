<div id="faction-studio-root" style="min-height: 800px; background: #1a1a1a; color: #eee; position: relative; border: 1px solid #333;">
    <div id="fs-boot-loader" class="active" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #1a1a1a; z-index: 50; display: flex; align-items: center; justify-content: center; opacity: 1; transition: opacity 0.4s;">
        <div style="text-align: center;">
            <div class="loader-spinner"></div>
            <div style="color: #ff7518; margin-top: 20px; font-family: 'Oswald', sans-serif; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 2px;">INITIALIZING FACTION STUDIO...</div>
        </div>
    </div>
</div>

<style>
@keyframes cc-spin { 
    0% { transform: rotate(0deg); } 
    100% { transform: rotate(360deg); } 
}
.loader-spinner { 
    width: 50px; 
    height: 50px; 
    border: 5px solid #333; 
    border-top: 5px solid #ff7518; 
    border-radius: 50%; 
    animation: cc-spin 1s linear infinite; 
    margin: 0 auto;
}
</style>

<script>
async function loadScript(url) {
    console.log("Loading script:", url);
    const response = await fetch(url + "?t=" + Date.now());
    const text = await response.text();
    const blob = new Blob([text], { type: "text/javascript" });
    const blobUrl = URL.createObjectURL(blob);
    return new Promise((resolve, reject) => {
        const script = document.createElement("script");
        script.src = blobUrl;
        script.onload = () => { 
            URL.revokeObjectURL(blobUrl); 
            resolve(); 
        };
        script.onerror = () => { 
            URL.revokeObjectURL(blobUrl); 
            reject(new Error("Failed to load: " + url)); // FIXED: Was missing opening parenthesis
        };
        document.head.appendChild(script);
    });
}

async function bootFactionStudio() {
    console.log("üöÄ Faction Studio Boot Starting...");
    
    try {
        // Load the script
        await loadScript("https://raw.githubusercontent.com/steamcrow/coffin/main/studio/studio_builder.js");
        console.log("‚úÖ Faction Studio scripts loaded");
        
        // IMPORTANT: Initialize the factory after script loads
        if (window.CCFB_FACTORY) {
            console.log("üé¨ Initializing CCFB_FACTORY...");
            CCFB_FACTORY.init();
        } else {
            console.error("‚ùå CCFB_FACTORY not found!");
        }
        
        // Hide the loader after a short delay to allow init to complete
        setTimeout(function() {
            const loader = document.getElementById("fs-boot-loader");
            if (loader) {
                loader.style.opacity = "0";
                setTimeout(function() {
                    loader.style.display = "none";
                }, 400);
            }
        }, 500);
        
    } catch (error) {
        console.error("‚ùå Boot failed:", error);
        const loader = document.getElementById("fs-boot-loader");
        if (loader) {
            loader.innerHTML = '<div style="text-align: center; color: #ff4444;">' +
                '<i class="fa fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 20px;"></i><br>' +
                'FAILED TO LOAD FACTION STUDIO<br>' +
                '<small>Check console for details</small>' +
                '</div>';
        }
    }
}

bootFactionStudio();
</script>
