// Function to handle the Blappo Knob Logic
(function() {
    const knob = document.querySelector('.cc-scroll-knob');
    const track = document.querySelector('.cc-scroll');
    const root = document.documentElement;

    if (!knob || !track) return;

    let isDragging = false;

    const updateMapPosition = (e) => {
        if (!isDragging) return;

        const rect = track.getBoundingClientRect();
        let percentage = (e.clientY - rect.top) / rect.height;

        // Clamp 0 to 1
        percentage = Math.max(0, Math.min(1, percentage));

        // 1. Visually move knob
        knob.style.top = (percentage * 100) + "%";

        // 2. Adjust Distortion (bulge map more as you zoom)
        const newWarp = 1.3 - (percentage * 0.4); 
        root.style.setProperty('--warp-scale', newWarp);

        // 3. Zoom the Map (Assuming 'map' is your Leaflet variable)
        if (window.map) {
            const minZoom = 2;
            const maxZoom = 6;
            const targetZoom = maxZoom - (percentage * (maxZoom - minZoom));
            window.map.setZoom(targetZoom);
        }
    };

    knob.addEventListener('mousedown', () => { isDragging = true; });
    window.addEventListener('mouseup', () => { isDragging = false; });
    window.addEventListener('mousemove', updateMapPosition);
})();
